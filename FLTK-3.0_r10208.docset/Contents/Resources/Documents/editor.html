<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>FLTK 3.0: Designing a Simple Text Editor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FLTK 3.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Designing a Simple Text Editor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter takes you through the design of a simple FLTK-based text editor.</p>
<h1><a class="anchor" id="editor_goals"></a>
Determining the Goals of the Text Editor</h1>
<p>Since this will be the first big project you'll be doing with FLTK, lets define what we want our text editor to do:</p>
<ol type="1">
<li>Provide a menubar/menus for all functions.</li>
<li>Edit a single text file, possibly with multiple views.</li>
<li>Load from a file.</li>
<li>Save to a file.</li>
<li>Cut/copy/delete/paste functions.</li>
<li>Search and replace functions.</li>
<li>Keep track of when the file has been changed.</li>
</ol>
<h1><a class="anchor" id="editor_main_window"></a>
Designing the Main Window</h1>
<p>Now that we've outlined the goals for our editor, we can begin with the design of our GUI. Obviously the first thing that we need is a window, which we'll place inside a class called <code>EditorWindow:</code> </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>EditorWindow : <span class="keyword">public</span> <a class="code" href="classfltk3_1_1DoubleWindow.html">fltk3::DoubleWindow</a> {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    EditorWindow(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h, <span class="keyword">const</span> <span class="keywordtype">char</span>* t);</div>
<div class="line">    ~EditorWindow();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classfltk3_1_1Window.html">fltk3::Window</a>          *replace_dlg;</div>
<div class="line">    <a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a>           *replace_find;</div>
<div class="line">    <a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a>           *replace_with;</div>
<div class="line">    <a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a>          *replace_all;</div>
<div class="line">    <a class="code" href="classfltk3_1_1ReturnButton.html">fltk3::ReturnButton</a>    *replace_next;</div>
<div class="line">    <a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a>          *replace_cancel;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classfltk3_1_1TextEditor.html">fltk3::TextEditor</a>      *editor;</div>
<div class="line">    <span class="keywordtype">char</span>                   search[256];</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="editor_variables"></a>
Variables</h1>
<p>Our text editor will need some global variables to keep track of things:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>                changed = 0;</div>
<div class="line"><span class="keywordtype">char</span>               filename[256] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a class="code" href="classfltk3_1_1TextBuffer.html">fltk3::TextBuffer</a>  *textbuf;</div>
</div><!-- fragment --><p>The <code>textbuf</code> variable is the text editor buffer for our window class described previously. We'll cover the other variables as we build the application.</p>
<h1><a class="anchor" id="editor_menubars"></a>
Menubars and Menus</h1>
<p>The first goal requires us to use a menubar and menus that define each function the editor needs to perform. The <a class="el" href="structfltk3_1_1MenuItem.html" title="The fltk3::MenuItem structure defines a single menu item that is used by the fltk3::Menu_ class...">fltk3::MenuItem</a> structure is used to define the menus and items in a menubar:</p>
<div class="fragment"><div class="line"><a class="code" href="structfltk3_1_1MenuItem.html">fltk3::MenuItem</a> menuitems[] = {</div>
<div class="line">  { <span class="stringliteral">&quot;&amp;File&quot;</span>,              0, 0, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a55fd4831d36526f6c4e9485f95f6600c">fltk3::SUBMENU</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;New File&quot;</span>,        0, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)new_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Open File...&quot;</span>,    <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;o&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)open_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Insert File...&quot;</span>,  <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;i&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)insert_cb, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a0372c5b79a5bee859975b04feac7f977">fltk3::MENU_DIVIDER</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Save File&quot;</span>,       <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;s&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)save_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;Save File &amp;As...&quot;</span>, <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <a class="code" href="namespacefltk3.html#a4d5103886f3d77b62c9cd94e38685c39">fltk3::SHIFT</a> + <span class="charliteral">&#39;s&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)saveas_cb, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a0372c5b79a5bee859975b04feac7f977">fltk3::MENU_DIVIDER</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;New &amp;View&quot;</span>, <a class="code" href="namespacefltk3.html#ade051ceb1746b9429cb45d5eb74d01e0">fltk3::ALT</a> + <span class="charliteral">&#39;v&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)view_cb, 0 },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Close View&quot;</span>, <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;w&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)close_cb, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a0372c5b79a5bee859975b04feac7f977">fltk3::MENU_DIVIDER</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;E&amp;xit&quot;</span>, <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;q&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)quit_cb, 0 },</div>
<div class="line">    { 0 },</div>
<div class="line"></div>
<div class="line">  { <span class="stringliteral">&quot;&amp;Edit&quot;</span>, 0, 0, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a55fd4831d36526f6c4e9485f95f6600c">fltk3::SUBMENU</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Undo&quot;</span>,       <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;z&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)undo_cb, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a0372c5b79a5bee859975b04feac7f977">fltk3::MENU_DIVIDER</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;Cu&amp;t&quot;</span>,        <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;x&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)cut_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Copy&quot;</span>,       <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;c&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)copy_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Paste&quot;</span>,      <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;v&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)paste_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Delete&quot;</span>,     0, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)delete_cb },</div>
<div class="line">    { 0 },</div>
<div class="line"></div>
<div class="line">  { <span class="stringliteral">&quot;&amp;Search&quot;</span>, 0, 0, 0, <a class="code" href="namespacefltk3.html#a6af167d2cfb4a4f3342336c0bcfa7cd5a55fd4831d36526f6c4e9485f95f6600c">fltk3::SUBMENU</a> },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Find...&quot;</span>,       <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;f&#39;</span>, (<a class="code" href="namespacefltk3.html#a56f4fa8aea0fbacc43467124eb8a43bb">fltk3::Callback</a> *)find_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;F&amp;ind Again&quot;</span>,    <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;g&#39;</span>, find2_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;&amp;Replace...&quot;</span>,    <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;r&#39;</span>, replace_cb },</div>
<div class="line">    { <span class="stringliteral">&quot;Re&amp;place Again&quot;</span>, <a class="code" href="namespacefltk3.html#a911d17e12050658c96176966a59e57fa">fltk3::COMMAND</a> + <span class="charliteral">&#39;t&#39;</span>, replace2_cb },</div>
<div class="line">    { 0 },</div>
<div class="line"></div>
<div class="line">  { 0 }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Once we have the menus defined we can create the <a class="el" href="classfltk3_1_1MenuBar.html" title="This widget provides a standard menubar interface. ">fltk3::MenuBar</a> widget and assign the menus to it with:</p>
<div class="fragment"><div class="line"><a class="code" href="classfltk3_1_1MenuBar.html">fltk3::MenuBar</a> *m = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1MenuBar.html">fltk3::MenuBar</a>(0, 0, 640, 30);</div>
<div class="line">m-&gt;<a class="code" href="classfltk3_1_1Menu__.html#a7151dc8329f29cd0e1557fa568dae5b7">copy</a>(menuitems);</div>
</div><!-- fragment --><p>We'll define the callback functions later.</p>
<h1><a class="anchor" id="editor_editing"></a>
Editing the Text</h1>
<p>To keep things simple our text editor will use the <a class="el" href="classfltk3_1_1TextEditor.html" title="This is the FLTK text editor widget. ">fltk3::TextEditor</a> widget to edit the text:</p>
<div class="fragment"><div class="line">w-&gt;editor = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1TextEditor.html">fltk3::TextEditor</a>(0, 30, 640, 370);</div>
<div class="line">w-&gt;editor-&gt;buffer(textbuf);</div>
</div><!-- fragment --><p>So that we can keep track of changes to the file, we also want to add a "modify" callback:</p>
<div class="fragment"><div class="line">textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a0202784d8661b8483346f57cb0c297e6">add_modify_callback</a>(changed_cb, w);</div>
<div class="line">textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad695b48f22f1c7be946b142da1c7a932">call_modify_callbacks</a>();</div>
</div><!-- fragment --><p>Finally, we want to use a mono-spaced font like <code><a class="el" href="namespacefltk3.html#ad414c74976a5995a8620e5e6e3118227" title="Courier normal. ">fltk3::COURIER</a>:</code> </p>
<div class="fragment"><div class="line">w-&gt;editor-&gt;textfont(<a class="code" href="namespacefltk3.html#ad414c74976a5995a8620e5e6e3118227">fltk3::COURIER</a>);</div>
</div><!-- fragment --><h1><a class="anchor" id="editor_replace_dialog"></a>
The Replace Dialog</h1>
<p>We can use the FLTK convenience functions for many of the editor's dialogs, however the replace dialog needs its own custom window. To keep things simple we will have a "find" string, a "replace" string, and "replace all", "replace next", and "cancel" buttons. The strings are just <a class="el" href="classfltk3_1_1Input.html" title="This is the FLTK text input widget. ">fltk3::Input</a> widgets, the "replace all" and "cancel" buttons are <a class="el" href="classfltk3_1_1Button.html" title="Buttons generate callbacks when they are clicked by the user. ">fltk3::Button</a> widgets, and the "replace next " button is a <a class="el" href="classfltk3_1_1ReturnButton.html" title="The fltk3::ReturnButton is a subclass of fltk3::Button that generates a callback when it is pressed o...">fltk3::ReturnButton</a> widget:</p>
<div class="image">
<img src="editor-replace.png" alt="editor-replace.png"/>
<div class="caption">
Figure 4-1: The search and replace dialog</div></div>
<div class="fragment"><div class="line"><a class="code" href="classfltk3_1_1Window.html">fltk3::Window</a> *replace_dlg = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Window.html">fltk3::Window</a>(300, 105, <span class="stringliteral">&quot;Replace&quot;</span>);</div>
<div class="line"><a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a> *replace_find = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a>(70, 10, 200, 25, <span class="stringliteral">&quot;Find:&quot;</span>);</div>
<div class="line"><a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a> *replace_with = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Input.html">fltk3::Input</a>(70, 40, 200, 25, <span class="stringliteral">&quot;Replace:&quot;</span>);</div>
<div class="line"><a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a> *replace_all = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a>(10, 70, 90, 25, <span class="stringliteral">&quot;Replace All&quot;</span>);</div>
<div class="line"><a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a> *replace_next = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a>(105, 70, 120, 25, <span class="stringliteral">&quot;Replace Next&quot;</span>);</div>
<div class="line"><a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a> *replace_cancel = <span class="keyword">new</span> <a class="code" href="classfltk3_1_1Button.html">fltk3::Button</a>(230, 70, 60, 25, <span class="stringliteral">&quot;Cancel&quot;</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="editor_callbacks"></a>
Callbacks</h1>
<p>Now that we've defined the GUI components of our editor, we need to define our callback functions.</p>
<h2><a class="anchor" id="editor_changed_cb"></a>
changed_cb()</h2>
<p>This function will be called whenever the user changes any text in the <code>editor</code> widget:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> changed_cb(<span class="keywordtype">int</span>, <span class="keywordtype">int</span> nInserted, <span class="keywordtype">int</span> nDeleted,<span class="keywordtype">int</span>, <span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  <span class="keywordflow">if</span> ((nInserted || nDeleted) &amp;&amp; !loading) changed = 1;</div>
<div class="line">  EditorWindow *w = (EditorWindow *)v;</div>
<div class="line">  set_title(w);</div>
<div class="line">  <span class="keywordflow">if</span> (loading) w-&gt;editor-&gt;show_insert_position();</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>set_title()</code> function is one that we will write to set the changed status on the current file. We're doing it this way because we want to show the changed status in the window's title bar.</p>
<h2><a class="anchor" id="editor_copy_cb"></a>
copy_cb()</h2>
<p>This callback function will call fltk3::Text_Editor::kf_copy() to copy the currently selected text to the clipboard:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> copy_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <a class="code" href="classfltk3_1_1TextEditor.html#ac6ac2c3fb93f838609676a3e34dc2076">fltk3::TextEditor::kf_copy</a>(0, e-&gt;editor);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_cut_cb"></a>
cut_cb()</h2>
<p>This callback function will call <a class="el" href="classfltk3_1_1TextEditor.html#af07b18fe88e71cdc3196ba72f211f9ad" title="Does a cut of selected text in the current buffer. ">fltk3::TextEditor::kf_cut()</a> to cut the currently selected text to the clipboard:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> cut_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <a class="code" href="classfltk3_1_1TextEditor.html#af07b18fe88e71cdc3196ba72f211f9ad">fltk3::TextEditor::kf_cut</a>(0, e-&gt;editor);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_delete_cb"></a>
delete_cb()</h2>
<p>This callback function will call <a class="el" href="classfltk3_1_1TextBuffer.html#a780c6df879f0b7868fb634a7c4ac31dd" title="Removes the text in the primary selection. ">fltk3::TextBuffer::remove_selection()</a> to delete the currently selected text to the clipboard:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> delete_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a780c6df879f0b7868fb634a7c4ac31dd">remove_selection</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_find_cb"></a>
find_cb()</h2>
<p>This callback function asks for a search string using the <a class="el" href="group__group__comdlg.html#ga81a7a29f9d4a63080c8541ca27ef9e73" title="Shows a dialog with a text message and a text input field. ">fltk3::input()</a> convenience function and then calls the <code>find2_cb()</code> function to find the string:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> find_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>* w, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *val;</div>
<div class="line"></div>
<div class="line">  val = <a class="code" href="group__group__comdlg.html#ga81a7a29f9d4a63080c8541ca27ef9e73">fltk3::input</a>(<span class="stringliteral">&quot;Search String:&quot;</span>, e-&gt;search);</div>
<div class="line">  <span class="keywordflow">if</span> (val != NULL) {</div>
<div class="line">    <span class="comment">// User entered a string - go find it!</span></div>
<div class="line">    strcpy(e-&gt;search, val);</div>
<div class="line">    find2_cb(w, v);</div>
<div class="line">  }</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_find2_cb"></a>
find2_cb()</h2>
<p>This function will find the next occurrence of the search string. If the search string is blank then we want to pop up the search dialog:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> find2_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>* w, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <span class="keywordflow">if</span> (e-&gt;search[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">    <span class="comment">// Search string is blank; get a new one...</span></div>
<div class="line">    find_cb(w, v);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> pos = e-&gt;editor-&gt;insert_position();</div>
<div class="line">  <span class="keywordtype">int</span> found = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a2d6853a711b8e49c05ce0581b2255ca6">search_forward</a>(pos, e-&gt;search, &amp;pos);</div>
<div class="line">  <span class="keywordflow">if</span> (found) {</div>
<div class="line">    <span class="comment">// Found a match; select and update the position...</span></div>
<div class="line">    textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a1df1d0f062be1e77fa8a1f4c5ff9e314">select</a>(pos, pos+strlen(e-&gt;search));</div>
<div class="line">    e-&gt;editor-&gt;insert_position(pos+strlen(e-&gt;search));</div>
<div class="line">    e-&gt;editor-&gt;show_insert_position();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <a class="code" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2">fltk3::alert</a>(<span class="stringliteral">&quot;No occurrences of \&#39;%s\&#39; found!&quot;</span>, e-&gt;search);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the search string cannot be found we use the <a class="el" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2" title="Shows an alert message dialog box. ">fltk3::alert()</a> convenience function to display a message to that effect.</p>
<h2><a class="anchor" id="editor_new_cb"></a>
new_cb()</h2>
<p>This callback function will clear the editor widget and current filename. It also calls the <code>check_save()</code> function to give the user the opportunity to save the current file first as needed:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> new_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>*) {</div>
<div class="line">  <span class="keywordflow">if</span> (!check_save()) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  filename[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a1df1d0f062be1e77fa8a1f4c5ff9e314">select</a>(0, textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a2641fb2bd259968071d414d4a07bc775">length</a>());</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a780c6df879f0b7868fb634a7c4ac31dd">remove_selection</a>();</div>
<div class="line">  changed = 0;</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad695b48f22f1c7be946b142da1c7a932">call_modify_callbacks</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_open_cb"></a>
open_cb()</h2>
<p>This callback function will ask the user for a filename and then load the specified file into the input widget and current filename. It also calls the <code>check_save()</code> function to give the user the opportunity to save the current file first as needed:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> open_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>*) {</div>
<div class="line">  <span class="keywordflow">if</span> (!check_save()) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">char</span> *newfile = fltk3::file_chooser(<span class="stringliteral">&quot;Open File?&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, filename);</div>
<div class="line">  <span class="keywordflow">if</span> (newfile != NULL) load_file(newfile, -1);</div>
<div class="line">}</div>
</div><!-- fragment --><p>We call the <code>load_file()</code> function to actually load the file.</p>
<h2><a class="anchor" id="editor_paste_cb"></a>
paste_cb()</h2>
<p>This callback function will call fltk3::Text_Editor::kf_paste() to paste the clipboard at the current position:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> paste_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <a class="code" href="classfltk3_1_1TextEditor.html#acadb5584bfd66d3f2ee92e64491b0aa7">fltk3::TextEditor::kf_paste</a>(0, e-&gt;editor);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_quit_cb"></a>
quit_cb()</h2>
<p>The quit callback will first see if the current file has been modified, and if so give the user a chance to save it. It then exits from the program:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> quit_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>*) {</div>
<div class="line">  <span class="keywordflow">if</span> (changed &amp;&amp; !check_save())</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  exit(0);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_replace_cb"></a>
replace_cb()</h2>
<p>The replace callback just shows the replace dialog:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> replace_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  e-&gt;replace_dlg-&gt;show();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_replace2_cb"></a>
replace2_cb()</h2>
<p>This callback will replace the next occurrence of the replacement string. If nothing has been entered for the replacement string, then the replace dialog is displayed instead:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> replace2_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *find = e-&gt;replace_find-&gt;value();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *replace = e-&gt;replace_with-&gt;value();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (find[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">    <span class="comment">// Search string is blank; get a new one...</span></div>
<div class="line">    e-&gt;replace_dlg-&gt;show();</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  e-&gt;replace_dlg-&gt;hide();</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> pos = e-&gt;editor-&gt;insert_position();</div>
<div class="line">  <span class="keywordtype">int</span> found = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a2d6853a711b8e49c05ce0581b2255ca6">search_forward</a>(pos, find, &amp;pos);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (found) {</div>
<div class="line">    <span class="comment">// Found a match; update the position and replace text...</span></div>
<div class="line">    textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a1df1d0f062be1e77fa8a1f4c5ff9e314">select</a>(pos, pos+strlen(find));</div>
<div class="line">    textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a780c6df879f0b7868fb634a7c4ac31dd">remove_selection</a>();</div>
<div class="line">    textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a567013ee3b4cdaca462579d94ffc8de2">insert</a>(pos, replace);</div>
<div class="line">    textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a1df1d0f062be1e77fa8a1f4c5ff9e314">select</a>(pos, pos+strlen(replace));</div>
<div class="line">    e-&gt;editor-&gt;insert_position(pos+strlen(replace));</div>
<div class="line">    e-&gt;editor-&gt;show_insert_position();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <a class="code" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2">fltk3::alert</a>(<span class="stringliteral">&quot;No occurrences of \&#39;%s\&#39; found!&quot;</span>, find);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_replall_cb"></a>
replall_cb()</h2>
<p>This callback will replace all occurrences of the search string in the file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> replall_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *find = e-&gt;replace_find-&gt;value();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *replace = e-&gt;replace_with-&gt;value();</div>
<div class="line"></div>
<div class="line">  find = e-&gt;replace_find-&gt;value();</div>
<div class="line">  <span class="keywordflow">if</span> (find[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">    <span class="comment">// Search string is blank; get a new one...</span></div>
<div class="line">    e-&gt;replace_dlg-&gt;show();</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  e-&gt;replace_dlg-&gt;hide();</div>
<div class="line"></div>
<div class="line">  e-&gt;editor-&gt;insert_position(0);</div>
<div class="line">  <span class="keywordtype">int</span> times = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Loop through the whole string</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> found = 1; found;) {</div>
<div class="line">    <span class="keywordtype">int</span> pos = e-&gt;editor-&gt;insert_position();</div>
<div class="line">    found = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a2d6853a711b8e49c05ce0581b2255ca6">search_forward</a>(pos, find, &amp;pos);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (found) {</div>
<div class="line">      <span class="comment">// Found a match; update the position and replace text...</span></div>
<div class="line">      textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a1df1d0f062be1e77fa8a1f4c5ff9e314">select</a>(pos, pos+strlen(find));</div>
<div class="line">      textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a780c6df879f0b7868fb634a7c4ac31dd">remove_selection</a>();</div>
<div class="line">      textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a567013ee3b4cdaca462579d94ffc8de2">insert</a>(pos, replace);</div>
<div class="line">      e-&gt;editor-&gt;insert_position(pos+strlen(replace));</div>
<div class="line">      e-&gt;editor-&gt;show_insert_position();</div>
<div class="line">      times++;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (times) <a class="code" href="group__group__comdlg.html#gac46e6b327231a5886501bb45b42b5d44">fltk3::message</a>(<span class="stringliteral">&quot;Replaced %d occurrences.&quot;</span>, times);</div>
<div class="line">  <span class="keywordflow">else</span> <a class="code" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2">fltk3::alert</a>(<span class="stringliteral">&quot;No occurrences of \&#39;%s\&#39; found!&quot;</span>, find);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_replcan_cb"></a>
replcan_cb()</h2>
<p>This callback just hides the replace dialog:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> replcan_cb(<a class="code" href="classfltk3_1_1Widget.html">fltk3::Widget</a>*, <span class="keywordtype">void</span>* v) {</div>
<div class="line">  EditorWindow* e = (EditorWindow*)v;</div>
<div class="line">  e-&gt;replace_dlg-&gt;hide();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_save_cb"></a>
save_cb()</h2>
<p>This callback saves the current file. If the current filename is blank it calls the "save as" callback:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> save_cb(<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">if</span> (filename[0] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line">    <span class="comment">// No filename - get one!</span></div>
<div class="line">    saveas_cb();</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> save_file(filename);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>save_file()</code> function saves the current file to the specified filename.</p>
<h2><a class="anchor" id="editor_saveas_cb"></a>
saveas_cb()</h2>
<p>This callback asks the user for a filename and saves the current file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> saveas_cb(<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordtype">char</span> *newfile;</div>
<div class="line"></div>
<div class="line">  newfile = fltk3::file_chooser(<span class="stringliteral">&quot;Save File As?&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, filename);</div>
<div class="line">  <span class="keywordflow">if</span> (newfile != NULL) save_file(newfile);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>save_file()</code> function saves the current file to the specified filename.</p>
<h1><a class="anchor" id="editor_other_functions"></a>
Other Functions</h1>
<p>Now that we've defined the callback functions, we need our support functions to make it all work:</p>
<h2><a class="anchor" id="editor_check_save"></a>
check_save()</h2>
<p>This function checks to see if the current file needs to be saved. If so, it asks the user if they want to save it:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> check_save(<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">if</span> (!changed) <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> r = <a class="code" href="group__group__comdlg.html#gac8835e6ad119f5ad2d13d732ae3c1a77">fltk3::choice</a>(<span class="stringliteral">&quot;The current file has not been saved.\n&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;Would you like to save it now?&quot;</span>,</div>
<div class="line">                    <span class="stringliteral">&quot;Cancel&quot;</span>, <span class="stringliteral">&quot;Save&quot;</span>, <span class="stringliteral">&quot;Discard&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (r == 1) {</div>
<div class="line">    save_cb(); <span class="comment">// Save the file...</span></div>
<div class="line">    <span class="keywordflow">return</span> !changed;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (r == 2) ? 1 : 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_load_file"></a>
load_file()</h2>
<p>This function loads the specified file into the <code>textbuf</code> variable:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> loading = 0;</div>
<div class="line"><span class="keywordtype">void</span> load_file(<span class="keywordtype">char</span> *newfile, <span class="keywordtype">int</span> ipos) {</div>
<div class="line">  loading = 1;</div>
<div class="line">  <span class="keywordtype">int</span> insert = (ipos != -1);</div>
<div class="line">  changed = insert;</div>
<div class="line">  <span class="keywordflow">if</span> (!insert) strcpy(filename, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  <span class="keywordtype">int</span> r;</div>
<div class="line">  <span class="keywordflow">if</span> (!insert) r = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a285936a668de01167e311526b9ac5624">loadfile</a>(newfile);</div>
<div class="line">  <span class="keywordflow">else</span> r = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a3d8b19e77ee95038b1310780b7db5924">insertfile</a>(newfile, ipos);</div>
<div class="line">  <span class="keywordflow">if</span> (r)</div>
<div class="line">    <a class="code" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2">fltk3::alert</a>(<span class="stringliteral">&quot;Error reading from file \&#39;%s\&#39;:\n%s.&quot;</span>, newfile, strerror(errno));</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keywordflow">if</span> (!insert) strcpy(filename, newfile);</div>
<div class="line">  loading = 0;</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad695b48f22f1c7be946b142da1c7a932">call_modify_callbacks</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>When loading the file we use the <a class="el" href="classfltk3_1_1TextBuffer.html#a285936a668de01167e311526b9ac5624" title="Loads a text file into the buffer. ">fltk3::TextBuffer::loadfile()</a> method to "replace" the text in the buffer, or the <a class="el" href="classfltk3_1_1TextBuffer.html#a3d8b19e77ee95038b1310780b7db5924" title="Inserts a file at the specified position. ">fltk3::TextBuffer::insertfile()</a> method to insert text in the buffer from the named file.</p>
<h2><a class="anchor" id="editor_save_file"></a>
save_file()</h2>
<p>This function saves the current buffer to the specified file:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> save_file(<span class="keywordtype">char</span> *newfile) {</div>
<div class="line">  <span class="keywordflow">if</span> (textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a6ea2a75487d6ec8d0b8c9378b9b4ec92">savefile</a>(newfile))</div>
<div class="line">    <a class="code" href="group__group__comdlg.html#ga1c6f6dcb11c2585814273ac1fb81b2b2">fltk3::alert</a>(<span class="stringliteral">&quot;Error writing to file \&#39;%s\&#39;:\n%s.&quot;</span>, newfile, strerror(errno));</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    strcpy(filename, newfile);</div>
<div class="line">  changed = 0;</div>
<div class="line">  textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad695b48f22f1c7be946b142da1c7a932">call_modify_callbacks</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="editor_set_title"></a>
set_title()</h2>
<p>This function checks the <code>changed</code> variable and updates the window label accordingly: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> set_title(<a class="code" href="classfltk3_1_1Window.html">fltk3::Window</a>* w) {</div>
<div class="line">  <span class="keywordflow">if</span> (filename[0] == <span class="charliteral">&#39;\0&#39;</span>) strcpy(title, <span class="stringliteral">&quot;Untitled&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">char</span> *slash;</div>
<div class="line">    slash = strrchr(filename, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (slash == NULL) slash = strrchr(filename, <span class="charliteral">&#39;\\&#39;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (slash != NULL) strcpy(title, slash + 1);</div>
<div class="line">    <span class="keywordflow">else</span> strcpy(title, filename);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (changed) strcat(title, <span class="stringliteral">&quot; (modified)&quot;</span>);</div>
<div class="line"></div>
<div class="line">  w-&gt;<a class="code" href="classfltk3_1_1Window.html#a555c7e4a2811a75574d62f7465996ab2">label</a>(title);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="editor_main_function"></a>
The main() Function</h1>
<p>Once we've created all of the support functions, the only thing left is to tie them all together with the <code>main()</code> function. The <code>main()</code> function creates a new text buffer, creates a new view (window) for the text, shows the window, loads the file on the command-line (if any), and then enters the FLTK event loop:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div>
<div class="line">  textbuf = <span class="keyword">new</span> fltk3::Text_Buffer;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="classfltk3_1_1Window.html">fltk3::Window</a>* window = new_view();</div>
<div class="line"></div>
<div class="line">  window-&gt;<a class="code" href="classfltk3_1_1Window.html#ad7541d0b5861f2e0536968dbfe192145">show</a>(1, argv);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (argc &gt; 1) load_file(argv[1], -1);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespacefltk3.html#a36870c51d30e7c54588846846c9cb363">fltk3::run</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="editor_compiling"></a>
Compiling the Editor</h1>
<p>The complete source for our text editor can be found in the <code>test/editor.cxx</code> source file. Both the Makefile and Visual C++ workspace include the necessary rules to build the editor. You can also compile it using a standard compiler with:</p>
<div class="fragment"><div class="line">CC -o editor editor.cxx -lfltk3 -lXext -lX11 -lm</div>
</div><!-- fragment --><p>or by using the <code>fltk3-config</code> script with:</p>
<div class="fragment"><div class="line">fltk3-config --compile editor.cxx</div>
</div><!-- fragment --><p>As noted in <a class="el" href="basics.html#basics_standard_compiler">Compiling Programs with Standard Compilers</a>, you may need to include compiler and linker options to tell them where to find the FLTK library. Also, the <code>CC</code> command may also be called <code>gcc</code> or <code>c++</code> on your system.</p>
<p>Congratulations, you've just built your own text editor!</p>
<h1><a class="anchor" id="editor_final_product"></a>
The Final Product</h1>
<p>The final editor window should look like the image in Figure 4-2.</p>
<div class="image">
<img src="editor.png" alt="editor.png"/>
<div class="caption">
Figure 4-2: The completed editor window</div></div>
<h1><a class="anchor" id="editor_advanced_features"></a>
Advanced Features</h1>
<p>Now that we've implemented the basic functionality, it is time to show off some of the advanced features of the fltk3::Text_Editor widget.</p>
<h2><a class="anchor" id="editor_syntax"></a>
Syntax Highlighting</h2>
<p>The <a class="el" href="classfltk3_1_1TextEditor.html" title="This is the FLTK text editor widget. ">fltk3::TextEditor</a> widget supports highlighting of text with different fonts, colors, and sizes. The implementation is based on the excellent <a href="http://www.nedit.org/">NEdit</a> text editor core, from <a href="http://www.nedit.org/,">http://www.nedit.org/,</a> which uses a parallel "style" buffer which tracks the font, color, and size of the text that is drawn.</p>
<p>Styles are defined using the <a class="el" href="structfltk3_1_1TextDisplay_1_1StyleTableEntry.html" title="This structure associates the color, font, andsize of a string to draw with an attribute mask matchin...">fltk3::TextDisplay::StyleTableEntry</a> structure defined in <code>&lt;FL/fltk3::TextDisplay.H&gt;</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>StyleTableEntry {</div>
<div class="line">  <a class="code" href="namespacefltk3.html#a44643260e605d97f3a5f833c6b1b8086">fltk3::Color</a> <a class="code" href="group__fl__attributes.html#ga615c74bc77454444f9bed319f5f6bf5a">color</a>;</div>
<div class="line">  <a class="code" href="namespacefltk3.html#a1708236811c6c62c009999433f1dcf39">fltk3::Font</a>  <a class="code" href="group__fl__attributes.html#ga67e975930acecd64688a8bf87f009c75">font</a>;</div>
<div class="line">  <span class="keywordtype">int</span>      <a class="code" href="group__fl__attributes.html#gab066f42e656f6e1d4501bca759077581">size</a>;</div>
<div class="line">  <span class="keywordtype">unsigned</span> attr;</div>
<div class="line">};</div>
</div><!-- fragment --><p>The <code>color</code> member sets the color for the text, the <code>font</code> member sets the FLTK font index to use, and the <code>size</code> member sets the pixel size of the text. The <code>attr</code> member is currently not used.</p>
<p>For our text editor we'll define 7 styles for plain code, comments, keywords, and preprocessor directives:</p>
<div class="fragment"><div class="line">fltk3::Text_Display::Style_Table_Entry styletable[] = {     <span class="comment">// Style table</span></div>
<div class="line">  { fltk3::BLACK,      <a class="code" href="namespacefltk3.html#ad414c74976a5995a8620e5e6e3118227">fltk3::COURIER</a>,        <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// A - Plain</span></div>
<div class="line">  { fltk3::DARK_GREEN, <a class="code" href="namespacefltk3.html#af3fd3350e91449e815865cd30afc88fa">fltk3::COURIER_ITALIC</a>, <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// B - Line comments</span></div>
<div class="line">  { fltk3::DARK_GREEN, <a class="code" href="namespacefltk3.html#af3fd3350e91449e815865cd30afc88fa">fltk3::COURIER_ITALIC</a>, <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// C - Block comments</span></div>
<div class="line">  { fltk3::BLUE,       <a class="code" href="namespacefltk3.html#ad414c74976a5995a8620e5e6e3118227">fltk3::COURIER</a>,        <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// D - Strings</span></div>
<div class="line">  { fltk3::DARK_RED,   <a class="code" href="namespacefltk3.html#ad414c74976a5995a8620e5e6e3118227">fltk3::COURIER</a>,        <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// E - Directives</span></div>
<div class="line">  { fltk3::DARK_RED,   <a class="code" href="namespacefltk3.html#a9843d8d4946b39c7103921da958a2edc">fltk3::COURIER_BOLD</a>,   <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }, <span class="comment">// F - Types</span></div>
<div class="line">  { fltk3::BLUE,       <a class="code" href="namespacefltk3.html#a9843d8d4946b39c7103921da958a2edc">fltk3::COURIER_BOLD</a>,   <a class="code" href="namespacefltk3.html#a7a89788ff8d6e42de892ec768a519203">fltk3::NORMAL_SIZE</a> }  <span class="comment">// G - Keywords</span></div>
<div class="line">};</div>
</div><!-- fragment --><p>You'll notice that the comments show a letter next to each style - each style in the style buffer is referenced using a character starting with the letter 'A'.</p>
<p>You call the <code>highlight_data()</code> method to associate the style data and buffer with the text editor widget:</p>
<div class="fragment"><div class="line">fltk3::Text_Buffer *stylebuf;</div>
<div class="line"></div>
<div class="line">w-&gt;editor-&gt;highlight_data(stylebuf, styletable,</div>
<div class="line">                          <span class="keyword">sizeof</span>(styletable) / <span class="keyword">sizeof</span>(styletable[0]),</div>
<div class="line">                          <span class="charliteral">&#39;A&#39;</span>, style_unfinished_cb, 0);</div>
</div><!-- fragment --><p>Finally, you need to add a callback to the main text buffer so that changes to the text buffer are mirrored in the style buffer:</p>
<div class="fragment"><div class="line">textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a0202784d8661b8483346f57cb0c297e6">add_modify_callback</a>(style_update, w-&gt;editor);</div>
</div><!-- fragment --><p>The <code>style_update()</code> function, like the <code>change_cb()</code> function described earlier, is called whenever text is added or removed from the text buffer. It mirrors the changes in the style buffer and then updates the style data as necessary:</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// &#39;style_update()&#39; - Update the style buffer...</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">style_update(<span class="keywordtype">int</span>        pos,          <span class="comment">// I - Position of update</span></div>
<div class="line">             <span class="keywordtype">int</span>        nInserted,    <span class="comment">// I - Number of inserted chars</span></div>
<div class="line">             <span class="keywordtype">int</span>        nDeleted,     <span class="comment">// I - Number of deleted chars</span></div>
<div class="line">             <span class="keywordtype">int</span>        nRestyled,    <span class="comment">// I - Number of restyled chars</span></div>
<div class="line">             <span class="keyword">const</span> <span class="keywordtype">char</span> *deletedText, <span class="comment">// I - Text that was deleted</span></div>
<div class="line">             <span class="keywordtype">void</span>       *cbArg) {     <span class="comment">// I - Callback data</span></div>
<div class="line">  <span class="keywordtype">int</span>  start,                         <span class="comment">// Start of text</span></div>
<div class="line">       end;                           <span class="comment">// End of text</span></div>
<div class="line">  <span class="keywordtype">char</span> last,                          <span class="comment">// Last style on line</span></div>
<div class="line">        style,                        <span class="comment">// Style data</span></div>
<div class="line">        text;                         <span class="comment">// Text data</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// If this is just a selection change, just unselect the style buffer...</span></div>
<div class="line">  <span class="keywordflow">if</span> (nInserted == 0 &amp;&amp; nDeleted == 0) {</div>
<div class="line">    stylebuf-&gt;unselect();</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Track changes in the text buffer...</span></div>
<div class="line">  <span class="keywordflow">if</span> (nInserted &gt; 0) {</div>
<div class="line">    <span class="comment">// Insert characters into the style buffer...</span></div>
<div class="line">    style = <span class="keyword">new</span> <span class="keywordtype">char</span>[nInserted + 1];</div>
<div class="line">    memset(style, <span class="charliteral">&#39;A&#39;</span>, nInserted);</div>
<div class="line">    style[nInserted] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line">    stylebuf-&gt;replace(pos, pos + nDeleted, style);</div>
<div class="line">    <span class="keyword">delete</span>[] style;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Just delete characters in the style buffer...</span></div>
<div class="line">    stylebuf-&gt;remove(pos, pos + nDeleted);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Select the area that was just updated to avoid unnecessary</span></div>
<div class="line">  <span class="comment">// callbacks...</span></div>
<div class="line">  stylebuf-&gt;select(pos, pos + nInserted - nDeleted);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Re-parse the changed region; we do this by parsing from the</span></div>
<div class="line">  <span class="comment">// beginning of the line of the changed region to the end of</span></div>
<div class="line">  <span class="comment">// the line of the changed region...  Then we check the last</span></div>
<div class="line">  <span class="comment">// style character and keep updating if we have a multi-line</span></div>
<div class="line">  <span class="comment">// comment character...</span></div>
<div class="line">  start = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a6492594a8d573312e64d5825b96ee170">line_start</a>(pos);</div>
<div class="line">  end   = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a0c5595e77dff19f84009e16425b78360">line_end</a>(pos + nInserted - nDeleted);</div>
<div class="line">  text  = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad5faae2bd527c4f8bf79d9a38362ab0c">text_range</a>(start, end);</div>
<div class="line">  style = stylebuf-&gt;text_range(start, end);</div>
<div class="line">  last  = style[end - start - 1];</div>
<div class="line"></div>
<div class="line">  style_parse(text, style, end - start);</div>
<div class="line"></div>
<div class="line">  stylebuf-&gt;replace(start, end, style);</div>
<div class="line">  ((fltk3::Text_Editor *)cbArg)-&gt;redisplay_range(start, end);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (last != style[end - start - 1]) {</div>
<div class="line">    <span class="comment">// The last character on the line changed styles, so reparse the</span></div>
<div class="line">    <span class="comment">// remainder of the buffer...</span></div>
<div class="line">    free(text);</div>
<div class="line">    free(style);</div>
<div class="line"></div>
<div class="line">    end   = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#a2641fb2bd259968071d414d4a07bc775">length</a>();</div>
<div class="line">    text  = textbuf-&gt;<a class="code" href="classfltk3_1_1TextBuffer.html#ad5faae2bd527c4f8bf79d9a38362ab0c">text_range</a>(start, end);</div>
<div class="line">    style = stylebuf-&gt;text_range(start, end);</div>
<div class="line"></div>
<div class="line">    style_parse(text, style, end - start);</div>
<div class="line"></div>
<div class="line">    stylebuf-&gt;replace(start, end, style);</div>
<div class="line">    ((fltk3::Text_Editor *)cbArg)-&gt;redisplay_range(start, end);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  free(text);</div>
<div class="line">  free(style);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>style_parse()</code> function scans a copy of the text in the buffer and generates the necessary style characters for display. It assumes that parsing begins at the start of a line:</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// &#39;style_parse()&#39; - Parse text and produce style data.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">style_parse(<span class="keyword">const</span> <span class="keywordtype">char</span> *text,</div>
<div class="line">            <span class="keywordtype">char</span>       *style,</div>
<div class="line">            <span class="keywordtype">int</span>        length) {</div>
<div class="line">  <span class="keywordtype">char</span>             current;</div>
<div class="line">  <span class="keywordtype">int</span>             col;</div>
<div class="line">  <span class="keywordtype">int</span>             last;</div>
<div class="line">  <span class="keywordtype">char</span>             buf[255],</div>
<div class="line">              bufptr;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *temp;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (current = *style, col = 0, last = 0; length &gt; 0; length --, text ++) {</div>
<div class="line">    <span class="keywordflow">if</span> (current == <span class="charliteral">&#39;A&#39;</span>) {</div>
<div class="line">      <span class="comment">// Check for directives, comments, strings, and keywords...</span></div>
<div class="line">      <span class="keywordflow">if</span> (col == 0 &amp;&amp; *text == <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line">        <span class="comment">// Set style to directive</span></div>
<div class="line">        current = <span class="charliteral">&#39;E&#39;</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__unicode.html#ga66ed3c027c8217723b222c7bf13e3df3">strncmp</a>(text, <span class="stringliteral">&quot;//&quot;</span>, 2) == 0) {</div>
<div class="line">        current = <span class="charliteral">&#39;B&#39;</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__unicode.html#ga66ed3c027c8217723b222c7bf13e3df3">strncmp</a>(text, <span class="stringliteral">&quot;/*&quot;</span>, 2) == 0) {</div>
<div class="line">        current = <span class="charliteral">&#39;C&#39;</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__unicode.html#ga66ed3c027c8217723b222c7bf13e3df3">strncmp</a>(text, <span class="stringliteral">&quot;\\\&quot;&quot;</span>, 2) == 0) {</div>
<div class="line">        <span class="comment">// Quoted quote...</span></div>
<div class="line">        *style++ = current;</div>
<div class="line">        *style++ = current;</div>
<div class="line">        text ++;</div>
<div class="line">        length --;</div>
<div class="line">        col += 2;</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*text == <span class="charliteral">&#39;\&quot;&#39;</span>) {</div>
<div class="line">        current = <span class="charliteral">&#39;D&#39;</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!last &amp;&amp; islower(*text)) {</div>
<div class="line">        <span class="comment">// Might be a keyword...</span></div>
<div class="line">        <span class="keywordflow">for</span> (temp = text, bufptr = buf;</div>
<div class="line">             islower(*temp) &amp;&amp; bufptr &lt; (buf + <span class="keyword">sizeof</span>(buf) - 1);</div>
<div class="line">             *bufptr++ = *temp++);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!islower(*temp)) {</div>
<div class="line">          *bufptr = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line">          bufptr = buf;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">if</span> (bsearch(&amp;bufptr, code_types,</div>
<div class="line">                      <span class="keyword">sizeof</span>(code_types) / <span class="keyword">sizeof</span>(code_types[0]),</div>
<div class="line">                      <span class="keyword">sizeof</span>(code_types[0]), compare_keywords)) {</div>
<div class="line">            <span class="keywordflow">while</span> (text &lt; temp) {</div>
<div class="line">              *style++ = <span class="charliteral">&#39;F&#39;</span>;</div>
<div class="line">              text ++;</div>
<div class="line">              length --;</div>
<div class="line">              col ++;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            text --;</div>
<div class="line">            length ++;</div>
<div class="line">            last = 1;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bsearch(&amp;bufptr, code_keywords,</div>
<div class="line">                             <span class="keyword">sizeof</span>(code_keywords) / <span class="keyword">sizeof</span>(code_keywords[0]),</div>
<div class="line">                             <span class="keyword">sizeof</span>(code_keywords[0]), compare_keywords)) {</div>
<div class="line">            <span class="keywordflow">while</span> (text &lt; temp) {</div>
<div class="line">              *style++ = <span class="charliteral">&#39;G&#39;</span>;</div>
<div class="line">              text ++;</div>
<div class="line">              length --;</div>
<div class="line">              col ++;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            text --;</div>
<div class="line">            length ++;</div>
<div class="line">            last = 1;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current == <span class="charliteral">&#39;C&#39;</span> &amp;&amp; <a class="code" href="group__fl__unicode.html#ga66ed3c027c8217723b222c7bf13e3df3">strncmp</a>(text, <span class="stringliteral">&quot;*/&quot;</span>, 2) == 0) {</div>
<div class="line">      <span class="comment">// Close a C comment...</span></div>
<div class="line">       style++ = current;</div>
<div class="line">       style++ = current;</div>
<div class="line">      text ++;</div>
<div class="line">      length --;</div>
<div class="line">      current = <span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line">      col += 2;</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current == <span class="charliteral">&#39;D&#39;</span>) {</div>
<div class="line">      <span class="comment">// Continuing in string...</span></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__fl__unicode.html#ga66ed3c027c8217723b222c7bf13e3df3">strncmp</a>(text, <span class="stringliteral">&quot;\\\&quot;&quot;</span>, 2) == 0) {</div>
<div class="line">        <span class="comment">// Quoted end quote...</span></div>
<div class="line">         style++ = current;</div>
<div class="line">         style++ = current;</div>
<div class="line">        text ++;</div>
<div class="line">        length --;</div>
<div class="line">        col += 2;</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*text == <span class="charliteral">&#39;\&quot;&#39;</span>) {</div>
<div class="line">        <span class="comment">// End quote...</span></div>
<div class="line">         style++ = current;</div>
<div class="line">        col ++;</div>
<div class="line">        current = <span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Copy style info...</span></div>
<div class="line">    <span class="keywordflow">if</span> (current == <span class="charliteral">&#39;A&#39;</span> &amp;&amp; (*text == <span class="charliteral">&#39;{&#39;</span> || *text == <span class="charliteral">&#39;}&#39;</span>)) *style++ = <span class="charliteral">&#39;G&#39;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> *style++ = current;</div>
<div class="line">    col ++;</div>
<div class="line"></div>
<div class="line">    last = isalnum(*text) || *text == <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (*text == <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line">      <span class="comment">// Reset column and possibly reset the style</span></div>
<div class="line">      col = 0;</div>
<div class="line">      <span class="keywordflow">if</span> (current == <span class="charliteral">&#39;B&#39;</span> || current == <span class="charliteral">&#39;E&#39;</span>) current = <span class="charliteral">&#39;A&#39;</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> 
<hr>
<table summary="navigation bar" width="100%" border="0">
<tr>
  <td width="45%" align="LEFT">
    <a class="el" href="common.html">
    [Prev]
    Common Widgets and Attributes
    </a>
  </td>
  <td width="10%" align="CENTER">
    <a class="el" href="index.html">[Index]</a>
  </td>
  <td width="45%" align="RIGHT">
    <a class="el" href="drawing.html">
    Drawing Things in FLTK
    [Next]
    </a>
  </td>
</tr>
</table>
 </div></div><!-- contents -->
<!-- BEGIN FLTK HTML_FOOTER -->
 <!-- Generated for FLTK 3.0 by Doxygen -->
   <li class="footer">
     <!-- Generated for FLTK 3.0 by Doxygen -->
     &copy; 1998-2011 by Bill Spitzak and others. &nbsp;&nbsp;&nbsp;
     <a href="http://www.fltk.org"><img src="tiny.png" align="bottom" alt="FLTK"></a>
   </li>
  </ul>
 </div>
<hr class="footer"/>
<address class="footer"><small>
  <div align="left">
    <a href="http://www.fltk.org"><img src="tiny.png" align="bottom" alt="FLTK"></a>
    &copy; 1998-2011 by Bill Spitzak and others.&nbsp;&nbsp;&nbsp;
    Permission is granted to reproduce this manual or any portion for
    any purpose, provided this copyright and permission notice are preserved.
  </div>
</small></address>
<!-- END FLTK HTML_FOOTER (/body and /html follows...) -->
</body>
</html>
