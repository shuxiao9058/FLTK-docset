<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>FLTK 3.0: Advanced FLTK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FLTK 3.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Advanced FLTK </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter explains advanced programming and design topics that will help you to get the most out of FLTK.</p>
<h1><a class="anchor" id="advanced_multithreading"></a>
Multithreading</h1>
<p>FLTK supports multithreaded applications using a locking mechanism based on "pthreads". We do not provide a threading interface as part of the library. However a simple example how threads can be implemented for all supported platforms can be found in <code>test/threads.h</code> and <code>test/threads.cxx</code>.</p>
<p>To use the locking mechanism, FLTK must be compiled with <code>&ndash;enable-threads</code> set during the <code>configure</code> process. IDE-based versions of FLTK are automatically compiled with locking enabled if possible.</p>
<p>In <code>main()</code>, call <a class="el" href="group__fl__multithread.html#ga3766ea2ba299968d3127970c06e0f88f" title="The lock() method blocks the current thread until it can safely access FLTK widgets and data...">fltk3::lock()</a> before <a class="el" href="namespacefltk3.html#a36870c51d30e7c54588846846c9cb363" title="As long as any windows are displayed this calls fltk3::wait() repeatedly. ">fltk3::run()</a> or <a class="el" href="namespacefltk3.html#a541733012d24b25a080b88dabcc03ece" title="Waits until &quot;something happens&quot; and then returns. ">fltk3::wait()</a> to start the runtime multithreading support for your program. All callbacks and derived functions like <code><a class="el" href="group__fl__events.html#ga614cc1e90af386f6ed5fe66724956879" title="Handle events from the window system. ">handle()</a></code> and <code><a class="el" href="group__fl__drawings.html#ga6f0835b51d1434db5b80f21f321e262c" title="Draws a nul-terminated UTF-8 string starting at the given x, y location. ">draw()</a></code> will now be properly locked:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <a class="code" href="group__fl__multithread.html#ga3766ea2ba299968d3127970c06e0f88f">fltk3::lock</a>();</div>
<div class="line">  <span class="comment">/* run thread */</span></div>
<div class="line">  <span class="keywordflow">while</span> (<a class="code" href="namespacefltk3.html#a541733012d24b25a080b88dabcc03ece">fltk3::wait</a>() &gt; 0) {</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__fl__multithread.html#gacfd58519b3043a9a3625c79d9b156a40">fltk3::thread_message</a>()) {</div>
<div class="line">      <span class="comment">/* process your data */</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can now start as many threads as you like. From within a thread (other than the main thread) FLTK calls must be wrapped with calls to <a class="el" href="group__fl__multithread.html#ga3766ea2ba299968d3127970c06e0f88f" title="The lock() method blocks the current thread until it can safely access FLTK widgets and data...">fltk3::lock()</a> and <a class="el" href="group__fl__multithread.html#ga07d3d4965696f433c45ace9ff9895fa0" title="The unlock() method releases the lock that was set using the lock() method. ">fltk3::unlock()</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="group__fl__multithread.html#ga3766ea2ba299968d3127970c06e0f88f">fltk3::lock</a>();      <span class="comment">// avoid conflicting calls</span></div>
<div class="line">...                 <span class="comment">// your code here</span></div>
<div class="line"><a class="code" href="group__fl__multithread.html#ga07d3d4965696f433c45ace9ff9895fa0">fltk3::unlock</a>();    <span class="comment">// allow other threads to access FLTK again</span></div>
</div><!-- fragment --><p>You can send messages from child threads to the main thread using <a class="el" href="group__fl__multithread.html#ga57ad2446eb494e5e235b268008ad1be4" title="Sends a message pointer to the main thread, causing any pending fltk3::wait() call to terminate so th...">fltk3::awake(void* message)</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> *msg;          <span class="comment">// &quot;msg&quot; is a pointer to your message</span></div>
<div class="line"><a class="code" href="group__fl__multithread.html#ga57ad2446eb494e5e235b268008ad1be4">fltk3::awake</a>(msg);  <span class="comment">// send &quot;msg&quot; to main thread</span></div>
</div><!-- fragment --><p>A message can be anything you like. The main thread can retrieve the message by calling <a class="el" href="group__fl__multithread.html#gacfd58519b3043a9a3625c79d9b156a40" title="The thread_message() method returns the last message that was sent from a child by the awake() method...">fltk3::thread_message()</a>. See example above.</p>
<p>You can also tell the main thread to call a function for you as soon as possible by using <a class="el" href="group__fl__multithread.html#gaa02c22e313b4819ebd65a0adc8ffc6e8" title="See void awake(void* message=0). ">fltk3::awake(fltk3::AwakeHandler cb, void* userdata)</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> do_something(<span class="keywordtype">void</span> *userdata) {</div>
<div class="line">  <span class="comment">// running with the main thread</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// running in another thread</span></div>
<div class="line"><span class="keywordtype">void</span> *data;       <span class="comment">// &quot;data&quot; is a pointer to your user data</span></div>
<div class="line"><a class="code" href="group__fl__multithread.html#ga57ad2446eb494e5e235b268008ad1be4">fltk3::awake</a>(do_something, data);  <span class="comment">// call something in main thread</span></div>
</div><!-- fragment --><p>FLTK supports multiple platforms, some of which allow only the main thread to handle system events and open or close windows. The safe thing to do is to adhere to the following rules for threads on all operating systems:</p>
<ul>
<li>Don't <code>show()</code> or <code>hide()</code> anything that contains widgets derived from fltk3Window, including dialogs, file choosers, subwindows or those using <a class="el" href="classfltk3_1_1GLWindow.html" title="The fltk3::GLWindow widget sets things up so OpenGL works. ">fltk3::GLWindow</a>.</li>
</ul>
<ul>
<li>Don't call <a class="el" href="namespacefltk3.html#a541733012d24b25a080b88dabcc03ece" title="Waits until &quot;something happens&quot; and then returns. ">fltk3::wait()</a>,<a class="el" href="namespacefltk3.html#a105e0036971e3dd802d782c3ba3fdc02" title="Causes all the windows that need it to be redrawn and graphics forced out through the pipes...">fltk3::flush()</a> or any related methods that will handle system messages</li>
</ul>
<ul>
<li>Don't start or cancel timers</li>
</ul>
<ul>
<li>Don't change window decorations or titles</li>
</ul>
<ul>
<li>The <code>make_current()</code> method may or may not work well for regular windows, but should always work for a <a class="el" href="classfltk3_1_1GLWindow.html" title="The fltk3::GLWindow widget sets things up so OpenGL works. ">fltk3::GLWindow</a> to allow for high speed rendering on graphics cards with multiple pipelines</li>
</ul>
<p>See also: <a class="el" href="group__fl__multithread.html#ga57ad2446eb494e5e235b268008ad1be4" title="Sends a message pointer to the main thread, causing any pending fltk3::wait() call to terminate so th...">fltk3::awake(void* message)</a>, <a class="el" href="group__fl__multithread.html#ga3766ea2ba299968d3127970c06e0f88f" title="The lock() method blocks the current thread until it can safely access FLTK widgets and data...">fltk3::lock()</a>, <a class="el" href="group__fl__multithread.html#gacfd58519b3043a9a3625c79d9b156a40" title="The thread_message() method returns the last message that was sent from a child by the awake() method...">fltk3::thread_message()</a>, <a class="el" href="group__fl__multithread.html#ga07d3d4965696f433c45ace9ff9895fa0" title="The unlock() method releases the lock that was set using the lock() method. ">fltk3::unlock()</a>.</p>
 
<hr>
<table summary="navigation bar" width="100%" border="0">
<tr>
  <td width="45%" align="LEFT">
    <a class="el" href="fluid.html">
    [Prev]
    Programming with FLUID
    </a>
  </td>
  <td width="10%" align="CENTER">
    <a class="el" href="index.html">[Index]</a>
  </td>
  <td width="45%" align="RIGHT">
    <a class="el" href="unicode.html">
    Unicode and utf-8 Support
    [Next]
    </a>
  </td>
</tr>
</table>
 </div></div><!-- contents -->
<!-- BEGIN FLTK HTML_FOOTER -->
 <!-- Generated for FLTK 3.0 by Doxygen -->
   <li class="footer">
     <!-- Generated for FLTK 3.0 by Doxygen -->
     &copy; 1998-2011 by Bill Spitzak and others. &nbsp;&nbsp;&nbsp;
     <a href="http://www.fltk.org"><img src="tiny.png" align="bottom" alt="FLTK"></a>
   </li>
  </ul>
 </div>
<hr class="footer"/>
<address class="footer"><small>
  <div align="left">
    <a href="http://www.fltk.org"><img src="tiny.png" align="bottom" alt="FLTK"></a>
    &copy; 1998-2011 by Bill Spitzak and others.&nbsp;&nbsp;&nbsp;
    Permission is granted to reproduce this manual or any portion for
    any purpose, provided this copyright and permission notice are preserved.
  </div>
</small></address>
<!-- END FLTK HTML_FOOTER (/body and /html follows...) -->
</body>
</html>
